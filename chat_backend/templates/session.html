<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ session.name }} - GNX History</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #1e1e1e; color: #e0e0e0; }
        .nav-tabs .nav-link { color: #aaa; border-color: #404040; }
        .nav-tabs .nav-link.active { background-color: #2d2d2d; color: #fff; border-color: #404040; border-bottom-color: #2d2d2d; }
        .tab-content { background-color: #2d2d2d; border: 1px solid #404040; border-top: none; padding: 20px; }
        
        .log-entry { margin-bottom: 15px; padding: 10px; border-radius: 5px; border-left: 4px solid transparent; }
        .log-user { background-color: #2b3e50; border-left-color: #0d6efd; }
        .log-ai { background-color: #2b5035; border-left-color: #198754; }
        .log-tool_call { background-color: #4a4a2b; border-left-color: #ffc107; font-family: monospace; }
        .log-tool_result { background-color: #333; border-left-color: #6c757d; font-family: monospace; }
        .log-system { background-color: #333; border-left-color: #dc3545; font-style: italic; }
        .log-image { background-color: #2d2d2d; border-left-color: #0dcaf0; }
        
        .timestamp { font-size: 0.8em; color: #888; margin-bottom: 5px; display: block; }
        .content { white-space: pre-wrap; overflow-x: auto; }
        .content img { max-width: 100%; border-radius: 5px; margin-top: 10px; }
        
        .read-more-btn { color: #61dafb; cursor: pointer; font-size: 0.9em; text-decoration: underline; }
        .truncated { max-height: 150px; overflow: hidden; position: relative; }
        .truncated::after { content: ""; position: absolute; bottom: 0; left: 0; width: 100%; height: 40px; background: linear-gradient(transparent, #333); }
        .log-tool_call .truncated::after { background: linear-gradient(transparent, #4a4a2b); }
        .log-user .truncated::after { background: linear-gradient(transparent, #2b3e50); }
        .log-ai .truncated::after { background: linear-gradient(transparent, #2b5035); }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-dark mb-4">
        <div class="container">
            <a class="navbar-brand" href="/">GNX History</a>
            <span class="navbar-text">{{ session.name }}</span>
        </div>
    </nav>

    <div class="container">
        <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="full-tab" data-bs-toggle="tab" data-bs-target="#full" type="button" role="tab">Full History (Original)</button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="context-tab" data-bs-toggle="tab" data-bs-target="#context" type="button" role="tab">LLM Context (Optimized)</button>
            </li>
        </ul>
        
        <div class="tab-content" id="myTabContent">
            <!-- Full History Tab -->
            <div class="tab-pane fade show active" id="full" role="tabpanel">
                {% for log in logs %}
                <div class="log-entry log-{{ log.type }}">
                    <span class="timestamp">{{ log.timestamp.strftime('%H:%M:%S') }} | {{ log.type.upper() }}</span>
                    <div class="content-wrapper">
                        {% if log.type == 'image' %}
                            <img src="{{ log.content }}" alt="Session Image">
                        {% else %}
                            <div class="content {% if log.content|length > 500 %}truncated{% endif %}">{{ log.content }}</div>
                            {% if log.content|length > 500 %}
                                <div class="read-more-btn mt-1" onclick="toggleReadMore(this)">Read More</div>
                            {% endif %}
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            
            <!-- LLM Context Tab -->
            <div class="tab-pane fade" id="context" role="tabpanel">
                {% for log in logs %}
                    {% if log.is_context %}
                    <div class="log-entry log-{{ log.type }}">
                        <span class="timestamp">{{ log.timestamp.strftime('%H:%M:%S') }} | {{ log.type.upper() }}</span>
                        <div class="content-wrapper">
                            <div class="content">{{ log.content }}</div>
                        </div>
                    </div>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function toggleReadMore(btn) {
            const contentDiv = btn.previousElementSibling;
            if (contentDiv.classList.contains('truncated')) {
                contentDiv.classList.remove('truncated');
                btn.textContent = "Show Less";
            } else {
                contentDiv.classList.add('truncated');
                btn.textContent = "Read More";
            }
        }
    </script>
</body>
</html>
